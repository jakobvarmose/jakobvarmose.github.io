(this.webpackJsonpnervegear2=this.webpackJsonpnervegear2||[]).push([[0],{201:function(e,t,a){e.exports=a(344)},344:function(e,t,a){"use strict";a.r(t);a(202);var n=a(0),r=a.n(n),c=a(31),s=a.n(c),o=a(77),l=a(6),i=a.n(l),u=a(17),m=a(118),d=a(119),p=a(142),f=a(131),v=a(22),b=a(32),E=a(346),h=a(20),O=a(352),x=a(353),g=a(37);var j=function(e){var t=e.homeserver,a=e.api2,c=Object(b.g)(),s=c.domain,o=c.local,l=Object(b.f)(),m=Object(n.useState)({}),d=Object(h.a)(m,2);return d[0],d[1],r.a.createElement("div",null,r.a.createElement("p",null,r.a.createElement(x.a,null,r.a.createElement(x.a.Item,null,r.a.createElement(v.b,{to:"/"},"Home")),r.a.createElement(x.a.Item,null,r.a.createElement(v.b,{to:"/media"},"Media")),r.a.createElement(x.a.Item,null,"mxc://".concat(s,"/").concat(o)))),r.a.createElement("p",null,s===t.substr(8)?r.a.createElement(g.a,{onClick:function(){O.a.confirm({title:"Delete media",content:r.a.createElement(r.a.Fragment,null,"This will delete this media item permanently."),onOk:function(){return Object(u.a)(i.a.mark((function e(){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,a("DELETE","/_synapse/admin/v1/media/".concat(s,"/").concat(o));case 3:l.push("/media"),e.next=9;break;case 6:e.prev=6,e.t0=e.catch(0),O.a.error({content:e.t0.toString()});case 9:case"end":return e.stop()}}),e,null,[[0,6]])})))()}})}},"Delete"):null),r.a.createElement("p",null,r.a.createElement("img",{src:"".concat(t,"/_matrix/media/r0/download/").concat(s,"/").concat(o)})))},w=a(39),_=a(45),k=a(191),I=a(349),y=a(348),S=a(347),C=a(63),T=a.n(C);var P=function(e){var t=e.size,a=Number(t);return r.a.createElement("span",null,a<1e3?"".concat(a):a<1e6?"".concat((a/1e3).toFixed(2),"k"):a<1e9?"".concat((a/1e6).toFixed(2),"M"):"".concat((a/1e9).toFixed(2),"G"))};var D=function(e){var t=e.homeserver,a=e.api2,c=Object(n.useState)(!1),s=Object(h.a)(c,2),o=s[0],l=(s[1],Object(n.useState)([])),m=Object(h.a)(l,2),d=m[0],p=m[1];function f(){return(f=Object(u.a)(i.a.mark((function e(){var t;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=T()(),O.a.confirm({title:"Purge media cache",content:r.a.createElement(r.a.Fragment,null,"This will delete all remote media before a given time.",r.a.createElement(I.a.Item,{label:"Before"},r.a.createElement(y.a,{showTime:!0,defaultValue:t,onChange:function(e){return t=e}}))),onOk:function(){return Object(u.a)(i.a.mark((function e(){var n;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,a("POST","/_synapse/admin/v1/purge_media_cache?before_ts=".concat(encodeURIComponent(new Date(t).getTime())),{});case 3:n=e.sent,O.a.success({content:"".concat(n.deleted," items deleted")}),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),O.a.error({content:e.t0.toString()});case 10:case"end":return e.stop()}}),e,null,[[0,7]])})))()}});case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return Object(n.useEffect)(Object(u.a)(i.a.mark((function e(){var t,n,r,c,s;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t=[],e.next=4,a("GET","/_synapse/admin/v2/users?from=0&limit=10000&deactivated=true");case 4:n=e.sent,r=Object(k.a)(n.users),e.prev=6,s=i.a.mark((function e(){var n,r;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=c.value,e.next=3,a("GET","/_synapse/admin/v1/users/".concat(encodeURIComponent(n.name),"/media"));case 3:r=e.sent,t=[].concat(Object(_.a)(t),Object(_.a)(r.media.map((function(e){return Object(w.a)(Object(w.a)({},e),{},{creator:n.name})})))),console.log(r),p(t),console.log(t);case 8:case"end":return e.stop()}}),e)})),r.s();case 9:if((c=r.n()).done){e.next=13;break}return e.delegateYield(s(),"t0",11);case 11:e.next=9;break;case 13:e.next=18;break;case 15:e.prev=15,e.t1=e.catch(6),r.e(e.t1);case 18:return e.prev=18,r.f(),e.finish(18);case 21:e.next=26;break;case 23:e.prev=23,e.t2=e.catch(0),console.error(e.t2);case 26:case"end":return e.stop()}}),e,null,[[0,23],[6,15,18,21]])}))),[]),r.a.createElement("div",null,r.a.createElement("p",null,r.a.createElement(x.a,null,r.a.createElement(x.a.Item,null,r.a.createElement(v.b,{to:"/"},"Home")),r.a.createElement(x.a.Item,null,"Media"))),r.a.createElement("p",null,r.a.createElement(g.a,{disabled:o,onClick:function(){return f.apply(this,arguments)}},"Purge media cache")),r.a.createElement(S.a,{columns:[{render:function(e){var a=e.media_id,n=e.media_type;return r.a.createElement(v.b,{to:"/media/".concat(t,"/").concat(a)},n.startsWith("image/")?r.a.createElement("img",{width:"32",height:"32",src:"https://".concat(t,"/_matrix/media/r0/thumbnail/").concat(t,"/").concat(a,"?width=32&height=32")}):null)}},{title:"ID",render:function(e){var a=e.media_id;return r.a.createElement(v.b,{to:"/media/".concat(t,"/").concat(a)},"mxc://",t,"/",a)}},{title:"Creator",render:function(e){var t=e.creator;return r.a.createElement(v.b,{to:"/user/".concat(t)},t)}},{title:"Type",dataIndex:"media_type"},{title:"Size",render:function(e){var t=e.media_length;return r.a.createElement(P,{size:t})}},{title:"Filename",dataIndex:"upload_name"}],dataSource:d}))};var U=function(e){return e.api2,r.a.createElement("div",null,r.a.createElement("p",null,r.a.createElement(x.a,null,r.a.createElement(x.a.Item,null,"Home"))),r.a.createElement("p",null,r.a.createElement(v.b,{to:"/user"},"Users")," | ",r.a.createElement(v.b,{to:"/room"},"Rooms")," | ",r.a.createElement(v.b,{to:"/media"},"Media")," | ",r.a.createElement(v.b,{to:"/server"},"Server info")))},A=a(351);var G=function(e){var t=e.onLogIn,a=Object(n.useState)(""),c=Object(h.a)(a,2),s=c[0],o=c[1],l=Object(n.useState)(""),m=Object(h.a)(l,2),d=m[0],p=m[1],f=Object(n.useState)(""),b=Object(h.a)(f,2),E=b[0],O=b[1],x=Object(n.useState)(!1),j=Object(h.a)(x,2),w=j[0],_=j[1];function k(){return(k=Object(u.a)(i.a.mark((function e(){var a;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,_(!0),(a=s).startsWith("@")&&a.includes(":")&&(a=a.substr(1,a.indexOf(":")-1)),e.next=6,t(a,d,E);case 6:e.next=10;break;case 8:e.prev=8,e.t0=e.catch(0);case 10:_(!1);case 11:case"end":return e.stop()}}),e,null,[[0,8]])})))).apply(this,arguments)}return r.a.createElement(I.a,null,r.a.createElement("h3",null,"Log in"),r.a.createElement(I.a.Item,{label:"MatrixID"},r.a.createElement(A.a,{disabled:w,value:s,onChange:function(e){o(e.target.value),e.target.value.indexOf(":")>=0&&O(e.target.value.substr(e.target.value.indexOf(":")+1))}})),r.a.createElement(I.a.Item,{label:"Password"},r.a.createElement(A.a.Password,{disabled:w,value:d,onChange:function(e){p(e.target.value)}})),r.a.createElement(I.a.Item,{label:"Homeserver"},r.a.createElement(A.a,{disabled:w,value:E,onChange:function(e){O(e.target.value)}})),r.a.createElement(I.a.Item,null,r.a.createElement(g.a,{disabled:w,onClick:function(){return k.apply(this,arguments)}},"Log in")),r.a.createElement(I.a.Item,null,r.a.createElement(v.b,{to:"/register"},"Register")))};var L=function(e){var t=e.userID,a=e.onLogOut,c=Object(n.useState)(!1),s=Object(h.a)(c,2),o=s[0],l=s[1];function m(){return(m=Object(u.a)(i.a.mark((function e(){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return l(!0),e.next=3,a();case 3:l(!1);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return r.a.createElement("p",null,"Logged in as ",r.a.createElement(v.b,{to:"/user/"+t},t)," ",r.a.createElement(g.a,{disabled:o,onClick:function(){return m.apply(this,arguments)}},"Log out"))},M=a(350);var R=function(e){var t=e.api2,a=Object(b.g)().roomID,c=Object(n.useState)({}),s=Object(h.a)(c,2),o=s[0],l=s[1],m=Object(n.useState)([]),d=Object(h.a)(m,2),p=d[0],f=d[1],E=Object(n.useState)([]),j=Object(h.a)(E,2),w=j[0],k=j[1];return Object(n.useEffect)(Object(u.a)(i.a.mark((function e(){var n,r;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t("GET","/_synapse/admin/v1/rooms/".concat(encodeURIComponent(a)));case 2:return n=e.sent,l(n),console.log(n),e.next=7,t("GET","/_synapse/admin/v1/rooms/".concat(encodeURIComponent(a),"/members"));case 7:r=e.sent,f(r.members),k(Object(_.a)(new Set(r.members.map((function(e){return e.substr(e.indexOf(":")+1)})))).sort());case 10:case"end":return e.stop()}}),e)}))),[a]),r.a.createElement("div",null,r.a.createElement("p",null,r.a.createElement(x.a,null,r.a.createElement(x.a.Item,null,r.a.createElement(v.b,{to:"/"},"Home")),r.a.createElement(x.a.Item,null,r.a.createElement(v.b,{to:"/room"},"Rooms")),r.a.createElement(x.a.Item,null,o.canonical_alias||a))),r.a.createElement(g.a,{onClick:function(){O.a.confirm({title:"Purge history of ".concat(o.canonical_alias||a),content:"Do you want to purge the room history of ".concat(o.canonical_alias||a,"?"),onOk:function(){return Object(u.a)(i.a.mark((function e(){var n,r,c,s;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t("POST","/_synapse/admin/v1/purge_history/".concat(a),{purge_up_to_ts:(new Date).getTime()});case 2:n=e.sent,r=n.purge_id,c="active";case 5:if("active"!==c){e.next=14;break}return e.next=8,new Promise((function(e){return setTimeout(e,1e3)}));case 8:return e.next=10,t("GET","/_synapse/admin/v1/purge_history_status/".concat(r));case 10:s=e.sent,c=s.status,e.next=5;break;case 14:"complete"===c?O.a.success({content:"Purge succeeded"}):O.a.error({content:"Purge failed"});case 15:case"end":return e.stop()}}),e)})))()}})}},"Purge history"),r.a.createElement(M.a,null,r.a.createElement(M.a.TabPane,{tab:"Properties",key:"1"},r.a.createElement(S.a,{columns:[{title:"Key",dataIndex:0},{title:"Value",dataIndex:1}],dataSource:Object.entries(o)})),r.a.createElement(M.a.TabPane,{tab:"Homeservers",key:"2"},r.a.createElement(S.a,{columns:[{title:"Name"}],dataSource:w})),r.a.createElement(M.a.TabPane,{tab:"Members",key:"3"},r.a.createElement(S.a,{columns:[{title:"MatrixID",render:function(e){return r.a.createElement(v.b,{to:"/user/".concat(e)},e)}}],dataSource:p}))))};var H=function(e){var t=e.api2,a=Object(n.useState)([]),c=Object(h.a)(a,2),s=c[0],o=c[1];return Object(n.useEffect)(Object(u.a)(i.a.mark((function e(){var a,n,r;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=0,o(n=[]);case 3:if(void 0===a){e.next=12;break}return e.next=6,t("GET","/_synapse/admin/v1/rooms?order_by=joined_members&from=".concat(encodeURIComponent(a)));case 6:r=e.sent,n=[].concat(Object(_.a)(n),Object(_.a)(r.rooms)),o(n),a=r.next_batch,e.next=3;break;case 12:case"end":return e.stop()}}),e)}))),[]),r.a.createElement(r.a.Fragment,null,r.a.createElement("p",null,r.a.createElement(x.a,null,r.a.createElement(x.a.Item,null,r.a.createElement(v.b,{to:"/"},"Home")),r.a.createElement(x.a.Item,null,"Rooms"))),r.a.createElement(S.a,{columns:[{title:"Alias",render:function(e){var t=e.room_id,a=e.canonical_alias;return r.a.createElement(v.b,{to:"/room/".concat(t)},a||t)},sorter:function(e,t){return(e.canonical_alias||e.room_id)<(t.canonical_alias||t.room_id)?-1:(e.canonical_alias||e.room_id)>(t.canonical_alias||t.room_id)?1:0}},{title:"Name",dataIndex:"name",sorter:function(e,t){return e.name<t.name?-1:e.name>t.name?1:0}},{title:"Members",dataIndex:"joined_members",sorter:function(e,t){return e.joined_members-t.joined_members}},{title:"Local members",dataIndex:"joined_local_members",sorter:function(e,t){return e.joined_local_members-t.joined_local_members}},{title:"Version",dataIndex:"version",sorter:function(e,t){return e.version<t.version?-1:e.version>t.version?1:0}}],dataSource:s}))};var N=function(e){var t=e.api2,a=Object(n.useState)({server:"",version:""}),c=Object(h.a)(a,2),s=c[0],o=c[1],l=Object(n.useState)({python_version:"",server_version:""}),m=Object(h.a)(l,2),d=m[0],p=m[1],f=Object(n.useState)({}),b=Object(h.a)(f,2),E=b[0],O=b[1],g=Object(n.useState)(null),j=Object(h.a)(g,2),w=j[0],_=j[1];return Object(n.useEffect)(Object(u.a)(i.a.mark((function e(){var a;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t("GET","/_matrix/federation/v1/version");case 2:a=e.sent,o(a);case 4:case"end":return e.stop()}}),e)}))),[]),Object(n.useEffect)(Object(u.a)(i.a.mark((function e(){var a;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t("GET","/_synapse/admin/v1/server_version");case 2:a=e.sent,p(a);case 4:case"end":return e.stop()}}),e)}))),[]),Object(n.useEffect)(Object(u.a)(i.a.mark((function e(){var a;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t("GET","/_matrix/client/versions");case 2:a=e.sent,O(a);case 4:case"end":return e.stop()}}),e)}))),[]),Object(n.useEffect)(Object(u.a)(i.a.mark((function e(){var a;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t("GET","/_matrix/client/r0/capabilities");case 2:a=e.sent,_(a.capabilities);case 4:case"end":return e.stop()}}),e)}))),[]),r.a.createElement("div",null,r.a.createElement("p",null,r.a.createElement(x.a,null,r.a.createElement(x.a.Item,null,r.a.createElement(v.b,{to:"/"},"Home")),r.a.createElement(x.a.Item,null,"Server info"))),r.a.createElement("p",null,"Server: ",s.server.name),r.a.createElement("p",null,"Version: ",d.server_version||s.server.version),d.python_version?r.a.createElement("p",null,"Python version: ",d.python_version):null,E.versions?r.a.createElement("div",null,r.a.createElement("p",null,"API versions:"),r.a.createElement("ul",null,E.versions.map((function(e){return r.a.createElement("li",{key:e},e)})))):null,E.unstable_features?r.a.createElement("div",null,r.a.createElement("p",null,"Unstable features:"),r.a.createElement("ul",null,Object.keys(E.unstable_features).filter((function(e){return E.unstable_features[e]})).map((function(e){return r.a.createElement("li",{key:e},e)})))):null,w?r.a.createElement("div",null,r.a.createElement("p",null,"Capabilities:"),r.a.createElement("ul",null,Object.keys(w).filter((function(e){return"m.room_versions"!==e})).sort().map((function(e){return r.a.createElement("li",{key:e},e,": ",JSON.stringify(w[e]))}))),w["m.room_versions"]?r.a.createElement("div",null,r.a.createElement("p",null,"Room Versions:"),r.a.createElement("ul",null,Object.keys(w["m.room_versions"].available).sort().map((function(e){return r.a.createElement("li",{key:e},e,": ",w["m.room_versions"].available[e],e===w["m.room_versions"].default?" (default)":"")})))):null):null)},F=a(110);var J=function(e){var t=e.onLogIn,a=Object(n.useState)(""),c=Object(h.a)(a,2),s=c[0],o=c[1],l=Object(n.useState)(""),m=Object(h.a)(l,2),d=m[0],p=m[1],f=Object(n.useState)(""),b=Object(h.a)(f,2),E=b[0],O=b[1],x=Object(n.useState)(!1),j=Object(h.a)(x,2),w=j[0],k=j[1],y=Object(n.useState)(""),S=Object(h.a)(y,2),C=S[0],T=S[1],P=Object(n.useState)(""),D=Object(h.a)(P,2),U=D[0],G=D[1],L=Object(n.useState)(!1),M=Object(h.a)(L,2),R=M[0];function H(){return(H=Object(u.a)(i.a.mark((function e(){var a,n,r,c,l,u,m,f,v;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,G(""),(a=s).startsWith("@")&&a.includes(":")&&(a=a.substr(1,a.indexOf(":")-1)),e.next=6,fetch("https://"+E+"/_synapse/admin/v1/register",{method:"GET"});case 6:return e.next=8,e.sent.json();case 8:return n=e.sent,r=n.nonce,c=new TextEncoder("utf-8"),l=w?"admin":"notadmin",e.next=14,window.crypto.subtle.importKey("raw",c.encode(C),{name:"HMAC",hash:{name:"SHA-1"}},!1,["sign"]);case 14:return u=e.sent,m=new Uint8Array([].concat(Object(_.a)(c.encode(r)),[0],Object(_.a)(c.encode(a)),[0],Object(_.a)(c.encode(d)),[0],Object(_.a)(c.encode(l)))),e.next=18,window.crypto.subtle.sign("HMAC",u,m);case 18:return f=e.sent,e.next=21,fetch("https://"+E+"/_synapse/admin/v1/register",{method:"POST",body:JSON.stringify({nonce:r,username:a,password:d,admin:w,mac:Array.prototype.map.call(new Uint8Array(f),(function(e){return("0"+e.toString(16)).slice(-2)})).join("")})});case 21:return e.next=23,e.sent.json();case 23:if(!("errcode"in(v=e.sent))){e.next=28;break}G(v.errcode+": "+v.error),e.next=34;break;case 28:return o(""),p(""),k(!1),T(""),e.next=34,t(a,d,E);case 34:e.next=39;break;case 36:e.prev=36,e.t0=e.catch(0),G(e.t0.toString());case 39:case"end":return e.stop()}}),e,null,[[0,36]])})))).apply(this,arguments)}return M[1],r.a.createElement(I.a,null,r.a.createElement("h3",null,"Register"),r.a.createElement(I.a.Item,null),r.a.createElement(I.a.Item,{label:"MatrixID"},r.a.createElement(A.a,{disabled:R,value:s,onChange:function(e){o(e.target.value),e.target.value.indexOf(":")>=0&&O(e.target.value.substr(e.target.value.indexOf(":")+1))}})),r.a.createElement(I.a.Item,{label:"Password"},r.a.createElement(A.a.Password,{disabled:R,value:d,onChange:function(e){p(e.target.value)}})),r.a.createElement(I.a.Item,{label:"Homeserver"},r.a.createElement(A.a,{disabled:R,value:E,onChange:function(e){O(e.target.value)}})),r.a.createElement(I.a.Item,null,r.a.createElement(F.a,{disabled:R,checked:w,onChange:function(e){var t=e.target.checked;k(t)}},"Admin")),r.a.createElement(I.a.Item,{label:"registration_shared_secret (from homeserver.yaml)"},r.a.createElement(A.a,{id:"sharedSecret",disabled:R,value:C,onChange:function(e){T(e.target.value)}})),r.a.createElement(I.a.Item,null,U),r.a.createElement(I.a.Item,null,r.a.createElement(g.a,{disabled:R,onClick:function(){return H.apply(this,arguments)}},"Register")),r.a.createElement(I.a.Item,null,r.a.createElement(v.b,{to:"/"},"Log in")))},V=a(157),z=a.n(V);var B=function(e){var t=e.api2,a=Object(b.g)().userID,c=Object(n.useState)({}),s=Object(h.a)(c,2),o=s[0],l=s[1],m=Object(n.useState)([]),d=Object(h.a)(m,2),p=d[0],f=d[1],E=Object(n.useState)([]),j=Object(h.a)(E,2),_=j[0],k=j[1];function y(){return(y=Object(u.a)(i.a.mark((function e(n){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t("POST","/_synapse/admin/v2/users/"+a+"/delete_devices",{devices:[n]});case 2:k(_.filter((function(e){return e.device_id!==n})));case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function C(){return T.apply(this,arguments)}function T(){return(T=Object(u.a)(i.a.mark((function e(){var n;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n="",O.a.confirm({title:"Change password for ".concat(a),content:r.a.createElement(r.a.Fragment,null,r.a.createElement(I.a.Item,{label:"New password"},r.a.createElement(A.a.Password,{onChange:function(e){return n=e.target.value}}))),onOk:function(){return Object(u.a)(i.a.mark((function e(){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,n){e.next=3;break}throw"Empty password";case 3:return e.next=5,t("PUT","/_synapse/admin/v2/users/"+a,{deactivated:!1,password:n});case 5:l(Object(w.a)(Object(w.a)({},o),{},{deactivated:0})),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),O.a.error({content:e.t0.toString()});case 11:case"end":return e.stop()}}),e,null,[[0,8]])})))()}});case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function P(){return(P=Object(u.a)(i.a.mark((function e(){var n;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=!1,O.a.confirm({title:"Deactivate ".concat(a),content:r.a.createElement(r.a.Fragment,null,"This will deactivate the account ",a,".",r.a.createElement(I.a.Item,null,r.a.createElement(z.a,{onChange:function(e){return n=e.target.checked}},"Also erase"))),onOk:function(){return Object(u.a)(i.a.mark((function e(){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t("POST","/_synapse/admin/v1/deactivate/".concat(encodeURIComponent(a)),{erase:n});case 3:l(Object(w.a)(Object(w.a)({},o),{},{deactivated:1})),e.next=9;break;case 6:e.prev=6,e.t0=e.catch(0),O.a.error({content:e.t0.toString()});case 9:case"end":return e.stop()}}),e,null,[[0,6]])})))()}});case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function D(){return(D=Object(u.a)(i.a.mark((function e(){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t("PUT","/_synapse/admin/v2/users/".concat(encodeURIComponent(a)),{admin:!0});case 2:l(Object(w.a)(Object(w.a)({},o),{},{admin:1}));case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function U(){return(U=Object(u.a)(i.a.mark((function e(){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t("PUT","/_synapse/admin/v2/users/".concat(encodeURIComponent(a)),{admin:!1});case 3:l(Object(w.a)(Object(w.a)({},o),{},{admin:0})),e.next=9;break;case 6:e.prev=6,e.t0=e.catch(0),O.a.error({content:e.t0.toString()});case 9:case"end":return e.stop()}}),e,null,[[0,6]])})))).apply(this,arguments)}return Object(n.useEffect)(Object(u.a)(i.a.mark((function e(){var n;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t("GET","/_synapse/admin/v2/users/"+a);case 3:n=e.sent,l(Object(w.a)(Object(w.a)({},o),n)),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),console.error(e.t0);case 10:case"end":return e.stop()}}),e,null,[[0,7]])}))),[]),Object(n.useEffect)(Object(u.a)(i.a.mark((function e(){var n;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t("GET","/_synapse/admin/v2/users/"+a+"/devices");case 3:"devices"in(n=e.sent)&&k(n.devices),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),console.error(e.t0);case 10:case"end":return e.stop()}}),e,null,[[0,7]])}))),[]),Object(n.useEffect)(Object(u.a)(i.a.mark((function e(){var n,r;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t("GET","/_synapse/admin/v1/users/"+a+"/joined_rooms");case 3:"joined_rooms"in(n=e.sent)&&(r=n.joined_rooms.map((function(e){return{room_id:e}})),f(r),n.joined_rooms.forEach(function(){var e=Object(u.a)(i.a.mark((function e(a){var n;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t("GET","/_synapse/admin/v1/rooms/"+a);case 2:n=e.sent,r=r.map((function(e){return e.room_id!=n.room_id?e:Object(w.a)(Object(w.a)({},e),n)})),f(r);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),console.error(e.t0);case 10:case"end":return e.stop()}}),e,null,[[0,7]])}))),[]),r.a.createElement("div",null,r.a.createElement("div",null,r.a.createElement("p",null,r.a.createElement(x.a,null,r.a.createElement(x.a.Item,null,r.a.createElement(v.b,{to:"/"},"Home")),r.a.createElement(x.a.Item,null,r.a.createElement(v.b,{to:"/user"},"Users")),r.a.createElement(x.a.Item,null,a))),0===o.deactivated?r.a.createElement(r.a.Fragment,null,r.a.createElement(g.a,{onClick:C},"Change password"),r.a.createElement(g.a,{onClick:function(){return P.apply(this,arguments)}},"Deactivate")):null,1===o.deactivated?r.a.createElement(g.a,{onClick:C},"Activate and set password"):null,0===o.admin?r.a.createElement(g.a,{onClick:function(){return D.apply(this,arguments)}},"Make admin"):null,1===o.admin?r.a.createElement(g.a,{onClick:function(){return U.apply(this,arguments)}},"Remove admin"):null,r.a.createElement(M.a,null,r.a.createElement(M.a.TabPane,{tab:"Properties",key:"1"},r.a.createElement(S.a,{columns:[{title:"Key",dataIndex:"0"},{title:"Value",dataIndex:"1"}],dataSource:Object.entries(o).map((function(e){var t=Object(h.a)(e,2),a=t[0],n=t[1];return"creation_ts"===a?[a,new Date(1e3*o[a]).toISOString()]:[a,n]}))})),r.a.createElement(M.a.TabPane,{tab:"Devices",key:"2"},r.a.createElement(S.a,{columns:[{title:"ID",dataIndex:"device_id"},{title:"Name",dataIndex:"display_name"},{title:"Last seen",render:function(e){var t=e.last_seen_ts;return t?new Date(t).toISOString():""}},{title:"IP address",dataIndex:"last_seen_ip"},{render:function(e){var t=e.device_id;return r.a.createElement(g.a,{onClick:function(){return function(e){return y.apply(this,arguments)}(t)}},"Delete")}}],dataSource:_})),r.a.createElement(M.a.TabPane,{tab:"Joined rooms",key:"3"},r.a.createElement(S.a,{columns:[{title:"ID",render:function(e){var t=e.room_id,a=e.canonical_alias;return r.a.createElement(v.b,{to:"/room/".concat(t)},a||t)}},{title:"Name",dataIndex:"name"},{title:"Members",dataIndex:"joined_members"},{title:"Version",dataIndex:"version"}],dataSource:p})))))};r.a.Component;var K=function(e){var t=e.onCreateUser,a=Object(n.useState)(""),c=Object(h.a)(a,2),s=c[0],o=c[1],l=Object(n.useState)(""),i=Object(h.a)(l,2),u=i[0],m=i[1],d=Object(n.useState)(!1),p=Object(h.a)(d,2),f=p[0],b=p[1];return r.a.createElement("div",null,r.a.createElement("p",null,r.a.createElement(x.a,null,r.a.createElement(x.a.Item,null,r.a.createElement(v.b,{to:"/"},"Home")),r.a.createElement(x.a.Item,null,r.a.createElement(v.b,{to:"/user"},"Users")),r.a.createElement(x.a.Item,null,"Create"))),r.a.createElement(I.a,null,r.a.createElement(I.a.Item,{label:"MatrixID"},r.a.createElement(A.a,{value:s,onChange:function(e){o(e.target.value)}})),r.a.createElement(I.a.Item,{label:"Password"},r.a.createElement(A.a.Password,{value:u,onChange:function(e){m(e.target.value)}})),r.a.createElement(I.a.Item,null,r.a.createElement(F.a,{checked:f,onChange:function(e){b(e.target.checked)}},"Admin")),r.a.createElement(I.a.Item,null,r.a.createElement(g.a,{onClick:function(){t(s,u,f)}},"Create"))))};var W=function(e){var t=e.users,a=e.onCreateUser;return e.onChangeActive,e.onChangeAdmin,e.self,function(e){var c=Object(n.useState)(),s=Object(h.a)(c,2),o=s[0],l=s[1],i=Object(n.useState)(""),u=Object(h.a)(i,2),m=u[0],d=u[1],p=Object(n.useState)(""),f=Object(h.a)(p,2),b=f[0],E=f[1],j=Object(n.useState)(!1),w=Object(h.a)(j,2),_=w[0],k=w[1];return r.a.createElement("div",null,r.a.createElement(O.a,{visible:o,okText:"Create",onCancel:function(){return l(!1)},onOk:function(){a(m,b,_)}},r.a.createElement(I.a,null,r.a.createElement(I.a.Item,{label:"MatrixID"},r.a.createElement(A.a,{value:m,onChange:function(e){d(e.target.value)}})),r.a.createElement(I.a.Item,{label:"Password"},r.a.createElement(A.a.Password,{value:b,onChange:function(e){E(e.target.value)}})),r.a.createElement(I.a.Item,null,r.a.createElement(F.a,{checked:_,onChange:function(e){k(e.target.checked)}},"Admin")))),r.a.createElement("p",null,r.a.createElement(x.a,null,r.a.createElement(x.a.Item,null,r.a.createElement(v.b,{to:"/"},"Home")),r.a.createElement(x.a.Item,null,"Users"))),r.a.createElement("p",null,r.a.createElement(g.a,{onClick:function(){return l(!0)}},"Create")),r.a.createElement(S.a,{columns:[{title:"MatrixID",dataIndex:"name",render:function(e){return r.a.createElement(v.b,{to:"/user/"+e},e)}},{title:"Name",dataIndex:"displayname"},{title:"Deactivated",dataIndex:"deactivated"},{title:"Guest",dataIndex:"is_guest"},{title:"Admin",dataIndex:"admin"}],dataSource:t}))}()},Y=function(e){Object(p.a)(a,e);var t=Object(f.a)(a);function a(){var e;Object(m.a)(this,a);for(var n=arguments.length,r=new Array(n),c=0;c<n;c++)r[c]=arguments[c];return(e=t.call.apply(t,[this].concat(r))).state={status:"loading",users:[],homeserver:null,accessToken:null,userID:null},e.api=function(){var t=Object(u.a)(i.a.mark((function t(a,n,r){var c;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return console.log("api",a,n),t.next=3,fetch(e.state.homeserver+n,{method:a,headers:{},body:JSON.stringify(r)});case 3:return c=t.sent,t.abrupt("return",c.json());case 5:case"end":return t.stop()}}),t)})));return function(e,a,n){return t.apply(this,arguments)}}(),e.api2=function(){var t=Object(u.a)(i.a.mark((function t(a,n,r){var c,s;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return console.log("api2",a,n),t.next=3,fetch(e.state.homeserver+n,{method:a,headers:{Authorization:"Bearer "+e.state.accessToken},body:JSON.stringify(r)});case 3:return c=t.sent,t.next=6,c.json();case 6:if(!("errcode"in(s=t.sent))){t.next=9;break}throw"".concat(s.errcode,": ").concat(s.error);case 9:if(c.ok){t.next=11;break}throw"".concat(s.statusText);case 11:return t.abrupt("return",s);case 12:case"end":return t.stop()}}),t)})));return function(e,a,n){return t.apply(this,arguments)}}(),e.onLogIn=function(){var t=Object(u.a)(i.a.mark((function t(a,n,r){var c;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.setState({homeserver:"https://"+r}),t.next=3,e.api("POST","/_matrix/client/r0/login",{type:"m.login.password",identifier:{type:"m.id.user",user:a},password:n,initial_device_display_name:"NerveGear"});case 3:"access_token"in(c=t.sent)&&(window.localStorage.setItem("mx_access_token",c.access_token),window.localStorage.setItem("mx_user_id",c.user_id),e.setState({status:"loggedin",accessToken:c.access_token,userID:c.user_id}),setTimeout(Object(u.a)(i.a.mark((function t(){return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.refresh();case 2:case"end":return t.stop()}}),t)})))));case 5:case"end":return t.stop()}}),t)})));return function(e,a,n){return t.apply(this,arguments)}}(),e.onChange=function(t){e.setState(Object(o.a)({},t.target.id,t.target.value))},e.refresh=Object(u.a)(i.a.mark((function t(){var a;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(console.log(e.state.status),"loggedin"!==e.state.status){t.next=13;break}return console.log("refreAPI"),t.prev=3,t.next=6,e.api2("GET","/_synapse/admin/v2/users?from=0&limit=10000&deactivated=true");case 6:"users"in(a=t.sent)&&e.setState({users:a.users}),t.next=13;break;case 10:t.prev=10,t.t0=t.catch(3),console.log("error",t.t0);case 13:case"end":return t.stop()}}),t,null,[[3,10]])}))),e.onChangeAdmin=function(){var t=Object(u.a)(i.a.mark((function t(a,n){return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.api2("PUT","/_synapse/admin/v2/users/"+a,{admin:n});case 2:return t.next=4,e.refresh();case 4:case"end":return t.stop()}}),t)})));return function(e,a){return t.apply(this,arguments)}}(),e.onChangeActive=function(){var t=Object(u.a)(i.a.mark((function t(a,n){var r;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!n){t.next=6;break}return r=prompt("New password"),t.next=4,e.api2("PUT","/_synapse/admin/v2/users/"+a,{deactivated:!1,password:r});case 4:t.next=8;break;case 6:return t.next=8,e.api2("POST","/_synapse/admin/v1/deactivate/"+a,{erase:!0});case 8:return t.next=10,e.refresh();case 10:case"end":return t.stop()}}),t)})));return function(e,a){return t.apply(this,arguments)}}(),e.onChangePassword=function(){var t=Object(u.a)(i.a.mark((function t(a){var n;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=prompt("New password"),t.next=3,e.api2("PUT","/_synapse/admin/v2/users/"+a,{password:n});case 3:e.refresh();case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),e.onLogOut=Object(u.a)(i.a.mark((function t(){return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.api2("POST","/_matrix/client/r0/logout",{});case 3:t.next=8;break;case 5:t.prev=5,t.t0=t.catch(0),console.error(t.t0);case 8:window.localStorage.removeItem("mx_access_token"),window.localStorage.removeItem("mx_user_id"),e.setState({status:"loggedout",users:[],accessToken:null,userID:null});case 11:case"end":return t.stop()}}),t,null,[[0,5]])}))),e.onCreateUser=function(){var t=Object(u.a)(i.a.mark((function t(a,n,r){return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return console.log(a,n,r),t.next=3,e.api2("PUT","/_synapse/admin/v2/users/"+a,{password:n,admin:r});case 3:e.refresh();case 4:case"end":return t.stop()}}),t)})));return function(e,a,n){return t.apply(this,arguments)}}(),e}return Object(d.a)(a,[{key:"componentDidMount",value:function(){var e=Object(u.a)(i.a.mark((function e(){var t,a,n,r=this;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:(t=window.localStorage.getItem("mx_access_token"))?(a=window.localStorage.getItem("mx_user_id"),n=a.substr(a.indexOf(":")+1),this.setState({status:"loggedin",accessToken:t,userID:a,homeserver:"https://"+n})):this.setState({status:"loggedout"}),setTimeout(Object(u.a)(i.a.mark((function e(){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.refresh();case 2:case"end":return e.stop()}}),e)}))));case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){return r.a.createElement(E.a,null,r.a.createElement(E.a.Content,{style:{padding:"1em"}},r.a.createElement("div",{style:{padding:"1em",backgroundColor:"#fff"}},r.a.createElement(v.a,null,"loading"===this.state.status?r.a.createElement("div",null,"Loading..."):"loggedout"===this.state.status?r.a.createElement("div",null,r.a.createElement(b.c,null,r.a.createElement(b.a,{path:"/register"},r.a.createElement(J,{onLogIn:this.onLogIn})),r.a.createElement(b.a,null,r.a.createElement(G,{onLogIn:this.onLogIn})))):r.a.createElement("div",null,r.a.createElement(L,{userID:this.state.userID,onLogOut:this.onLogOut}),r.a.createElement("hr",null),r.a.createElement(b.c,null,r.a.createElement(b.a,{path:"/user/create",exact:!0},r.a.createElement(K,{onCreateUser:this.onCreateUser})),r.a.createElement(b.a,{path:"/user/:userID",children:r.a.createElement(B,{users:this.state.users,api2:this.api2})}),r.a.createElement(b.a,{path:"/media/:domain/:local",children:r.a.createElement(j,{homeserver:this.state.homeserver,api2:this.api2})}),r.a.createElement(b.a,{path:"/server",exact:!0},r.a.createElement(N,{api2:this.api2})),r.a.createElement(b.a,{path:"/media",exact:!0},r.a.createElement(D,{api2:this.api2,homeserver:this.state.homeserver.substr(8)})),r.a.createElement(b.a,{path:"/room",exact:!0,children:r.a.createElement(H,{api2:this.api2})}),r.a.createElement(b.a,{path:"/room/:roomID",children:r.a.createElement(R,{api2:this.api2})}),r.a.createElement(b.a,{path:"/user",exact:!0},r.a.createElement(W,{self:this.state.matrixID,users:this.state.users,onChangeActive:this.onChangeActive,onChangeAdmin:this.onChangeAdmin,onChangePassword:this.onChangePassword})),r.a.createElement(b.a,{path:"/",exact:!0},r.a.createElement(U,null)),r.a.createElement(b.a,null,r.a.createElement("p",null,r.a.createElement(v.b,{to:"/user"},"Users")))))))),r.a.createElement(E.a.Footer,{style:{textAlign:"center",color:"#777777"}},"NerveGear - homeserver administrator"))}}]),a}(r.a.Component);s.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(Y,null)),document.getElementById("root"))}},[[201,1,2]]]);
//# sourceMappingURL=main.418bf5f6.chunk.js.map